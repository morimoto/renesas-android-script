From b4cad9db406e277e2dd47870200da79f33641a82 Mon Sep 17 00:00:00 2001
From: Oleh Cherpak <oleh.cherpak@globallogic.com>
Date: Mon, 5 Oct 2020 17:04:59 +0300
Subject: [PATCH] sign_target_files_apks: Fix password encrypted keys handle

Jira-Id: ADM-5102
Signed-off-by: Oleh Cherpak <oleh.cherpak@globallogic.com>
Change-Id: Idd68002f28701818d153e4105120d14a776f8a22
---
 tools/releasetools/apex_utils.py             | 4 ++--
 tools/releasetools/sign_target_files_apks.py | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/tools/releasetools/apex_utils.py b/tools/releasetools/apex_utils.py
index 1c61938048..b3af7f16af 100644
--- a/tools/releasetools/apex_utils.py
+++ b/tools/releasetools/apex_utils.py
@@ -110,7 +110,7 @@ class ApexApkSigner(object):
       # signed apk file.
       unsigned_apk = common.MakeTempFile()
       os.rename(apk_path, unsigned_apk)
-      common.SignFile(unsigned_apk, apk_path, key_name, self.key_passwords,
+      common.SignFile(unsigned_apk, apk_path, key_name, self.key_passwords[key_name],
                       codename_to_api_level_map=self.codename_to_api_level_map)
       has_signed_apk = True
     return payload_dir, has_signed_apk
@@ -356,7 +356,7 @@ def SignApex(avbtool, apex_data, payload_key, container_key, container_pw,
       aligned_apex,
       signed_apex,
       container_key,
-      container_pw,
+      container_pw[container_key],
       codename_to_api_level_map=codename_to_api_level_map,
       extra_signapk_args=extra_signapk_args)
 
diff --git a/tools/releasetools/sign_target_files_apks.py b/tools/releasetools/sign_target_files_apks.py
index 47360c9464..5ba46aa847 100755
--- a/tools/releasetools/sign_target_files_apks.py
+++ b/tools/releasetools/sign_target_files_apks.py
@@ -515,7 +515,7 @@ def ProcessTargetFiles(input_tf_zip, output_tf_zip, misc_info,
             data,
             payload_key,
             container_key,
-            key_passwords[container_key],
+            key_passwords,
             apk_keys,
             codename_to_api_level_map,
             no_hashtree=True,
-- 
2.29.0

